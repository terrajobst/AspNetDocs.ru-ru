---
uid: web-forms/overview/presenting-and-managing-data/model-binding/retrieving-data
title: Извлечение и отображение данных с помощью привязки модели и веб-форм | Документация Майкрософт
author: Rick-Anderson
description: В этой серии руководств демонстрируются основные аспекты использования привязки модели с проектом веб-форм ASP.NET. Привязка модели делает взаимодействие данных более прямым-...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 9f24fb82-c7ac-48da-b8e2-51b3da17e365
msc.legacyurl: /web-forms/overview/presenting-and-managing-data/model-binding/retrieving-data
msc.type: authoredcontent
ms.openlocfilehash: 81cca22cb4752d071d2a68986ae9ac2bed737594
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78520026"
---
# <a name="retrieving-and-displaying-data-with-model-binding-and-web-forms"></a>Извлечение и отображение данных с помощью привязки модели и веб-форм

> В этой серии руководств демонстрируются основные аспекты использования привязки модели с проектом веб-форм ASP.NET. Привязка модели делает взаимодействие данных более прямым, чем работа с объектами источника данных (например, ObjectDataSource или SqlDataSource). Эта серия начинается с вводного материала и переходит к более сложным концепциям в последующих руководствах.
> 
> Шаблон привязки модели работает с любыми технологиями доступа к данным. В этом учебнике вы будете использовать Entity Framework, но вы можете использовать технологию доступа к данным, наиболее привычную для вас. Из элемента управления сервера с привязкой к данным, такого как GridView, ListView, DetailsView или FormView, указываются имена методов, используемых для выбора, обновления, удаления и создания данных. В этом руководстве вы укажете значение для SelectMethod. 
> 
> В этом методе вы предоставляете логику для извлечения данных. В следующем руководстве будут заданы значения для UpdateMethod, DeleteMethod и InsertMethod.
>
> Вы можете [скачать](https://go.microsoft.com/fwlink/?LinkId=286116) полный проект в C# или Visual Basic. Загружаемый код работает с Visual Studio 2012 и более поздними версиями. В нем используется шаблон Visual Studio 2012, который немного отличается от шаблона Visual Studio 2017, показанного в этом руководстве.
> 
> В этом руководстве вы запускаете приложение в Visual Studio. Вы также можете развернуть приложение на поставщике услуг размещения и сделать его доступным через Интернет. Корпорация Майкрософт предлагает бесплатное веб-размещение для 10 веб-сайтов в  
> [Бесплатная пробная учетная запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A443DD604). Сведения о том, как развернуть веб-проект Visual Studio в веб-приложениях службы приложений Azure, см. в разделе [веб-развертывание ASP.NET с использованием Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md) Series. В этом учебнике также показано, как использовать Entity Framework Code First Migrations для развертывания базы данных SQL Server в базе данных SQL Azure.
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> - Microsoft Visual Studio 2017 или Microsoft Visual Studio Community 2017
>   
> Этот учебник также работает с Visual Studio 2012 и Visual Studio 2013, но существуют некоторые различия в пользовательском интерфейсе и шаблоне проекта.

## <a name="what-youll-build"></a>Что будет построено

В этом руководстве вы выполните следующие действия.

* Создание объектов данных, отражающих университет с участием учащихся в курсах
* Построение таблиц базы данных из объектов
* Заполнение базы данных тестовыми данными
* Отображение данных в веб-форме

## <a name="create-the-project"></a>Создание проекта

1. В Visual Studio 2017 создайте проект **веб-приложения ASP.NET (.NET Framework)** с именем **контосауниверситимоделбиндинг**.

   ![создание проекта](retrieving-data/_static/image19.png)

2. Нажмите кнопку **ОК**. Откроется диалоговое окно для выбора шаблона.

   ![Выбор веб-форм](retrieving-data/_static/image3.png)

3. Выберите шаблон **веб-формы** . 

4. При необходимости измените проверку подлинности для **отдельных учетных записей пользователей**. 

5. Чтобы создать проект, щелкните **ОК**.

## <a name="modify-site-appearance"></a>Изменение внешнего вида сайта

   Внесите несколько изменений, чтобы настроить внешний вид сайта. 
   
   1. Откройте файл Site. master.
   
   2. Измените заголовок, чтобы отобразить **университет Contoso** , а не **мое приложение ASP.NET**.

      [!code-aspx-csharp[Main](retrieving-data/samples/sample1.aspx?highlight=1)]

   3. Измените текст заголовка с **имени приложения** на **contoso университет**.

      [!code-aspx-csharp[Main](retrieving-data/samples/sample2.aspx?highlight=7)]

   4. Измените ссылки заголовка навигации на соответствующие сайту. 
   
      Удалите ссылки для **About** и **Contact** и, вместо этого, создайте ссылку на страницу **учащихся** , которую вы создадите.

      [!code-aspx-csharp[Main](retrieving-data/samples/sample3.aspx)]

   5. Сохраните site. master.

## <a name="add-a-web-form-to-display-student-data"></a>Добавление веб-формы для показа данных учащихся

   1. В **Обозреватель решений**щелкните правой кнопкой мыши проект, выберите **Добавить** , а затем **новый элемент**. 
   
   2. В диалоговом окне **Добавление нового элемента** выберите шаблон **веб-форма с главной страницей** и назовите его **students. aspx**.

      ![создать страницу](retrieving-data/_static/image5.png)

   3. Выберите **Добавить**.
   
   4. Для главной страницы веб-формы выберите **site. master**.
   
   5. Нажмите кнопку **ОК**.

## <a name="add-the-data-model"></a>Добавление модели данных

В папке **Models** добавьте класс с именем **UniversityModels.CS**.

   1. Щелкните правой кнопкой мыши элемент **модели**, выберите **Добавить**, а затем **новый элемент**. Откроется диалоговое окно **Добавление нового элемента**.

   2. В меню навигации слева выберите **код**, а затем — **класс**.

      ![Создание класса Model](retrieving-data/_static/image20.png)

   3. Назовите класс **UniversityModels.CS** и выберите **Добавить**.

      В этом файле определите классы `SchoolContext`, `Student`, `Enrollment`и `Course` следующим образом:

      [!code-csharp[Main](retrieving-data/samples/sample4.cs)]

      Класс `SchoolContext` является производным от `DbContext`, который управляет подключением к базе данных и изменениями в данных.

      В классе `Student` Обратите внимание на атрибуты, применяемые к свойствам `FirstName`, `LastName`и `Year`. В этом руководстве используются эти атрибуты для проверки данных. Чтобы упростить код, только эти свойства помечаются атрибутами проверки данных. В реальном проекте атрибуты проверки применяются ко всем свойствам, которым требуется проверка.

   4. Сохраните UniversityModels.cs.

## <a name="set-up-the-database-based-on-classes"></a>Настройка базы данных на основе классов

В этом руководстве для создания объектов и таблиц базы данных используется [Code First migrations](https://docs.microsoft.com/ef/ef6/modeling/code-first/migrations/) . В этих таблицах хранятся сведения о учащихся и их курсах.

   1. Выберите **Инструменты** > **Диспетчер пакетов NuGet** > **Консоль диспетчера пакетов**.

   2. В **консоли диспетчера пакетов**выполните следующую команду:  
      `enable-migrations -ContextTypeName ContosoUniversityModelBinding.Models.SchoolContext`

      Если команда выполнена успешно, отображается сообщение о том, что миграция включена.

      ![включить миграции](retrieving-data/_static/image8.png)

      Обратите внимание, что был создан файл с именем *Configuration.CS* . Класс `Configuration` содержит метод `Seed`, который может заранее заполнить таблицы базы данных тестовыми данными.

## <a name="pre-populate-the-database"></a>Предварительное заполнение базы данных

   1. Откройте Configuration.cs.
   
   2. Добавьте в метод `Seed` следующий код. Кроме того, добавьте оператор `using` для пространства имен `ContosoUniversityModelBinding. Models`.

      [!code-csharp[Main](retrieving-data/samples/sample5.cs)]

   3. Сохраните Configuration.cs.

   4. В консоли диспетчера пакетов выполните команду **Добавить-миграцию начальный**.

   5. Выполните команду **Update-Database**.

      Если при выполнении этой команды выдается исключение, то значения `StudentID` и `CourseID` могут отличаться от значений методов `Seed`. Откройте эти таблицы базы данных и найдите существующие значения для `StudentID` и `CourseID`. Добавьте эти значения в код для заполнения таблицы `Enrollments`.

## <a name="add-a-gridview-control"></a>Добавление элемента управления GridView

Заполненные данные базы данных теперь готовы к извлечению и отображению данных. 

1. Откройте students. aspx.

2. Находите заполнитель `MainContent`. В пределах этого заполнителя добавьте элемент управления **GridView** , включающий этот код.

   [!code-aspx-csharp[Main](retrieving-data/samples/sample6.aspx)]

   Обратите внимание на следующее:
   * Обратите внимание на значение, заданное для свойства `SelectMethod` в элементе GridView. Это значение указывает метод, используемый для получения данных GridView, которые создаются на следующем шаге. 
   
   * Для свойства `ItemType` задан класс `Student`, созданный ранее. Этот параметр позволяет ссылаться на свойства класса в разметке. Например, класс `Student` содержит коллекцию с именем `Enrollments`. Для получения этой коллекции можно использовать `Item.Enrollments`, а затем использовать [синтаксис LINQ](https://docs.microsoft.com/dotnet/csharp/programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq) для получения суммы зарегистрированных кредитов каждого учащегося.
   
3. Сохраните учащихся. aspx.

## <a name="add-code-to-retrieve-data"></a>Добавление кода для получения данных

   В файле кода программной части students. aspx добавьте метод, указанный для значения `SelectMethod`. 
   
   1. Откройте Students.aspx.cs.
   
   2. Добавьте операторы `using` для пространств имен `ContosoUniversityModelBinding. Models` и `System.Data.Entity`.

      [!code-csharp[Main](retrieving-data/samples/sample7.cs)]

   3. Добавьте метод, указанный для `SelectMethod`:

      [!code-csharp[Main](retrieving-data/samples/sample8.cs)]

      Предложение `Include` улучшает производительность запросов, но не является обязательным. Без предложения `Include` данные извлекаются с [*отложенной загрузкой*](https://en.wikipedia.org/wiki/Lazy_loading), что включает отправку отдельного запроса к базе данных при каждом извлечении связанных данных. При использовании предложения `Include` данные извлекаются с помощью *безотлагательной загрузки*, что означает, что один запрос к базе данных получает все связанные данные. Если связанные данные не используются, безотлагательная загрузка менее эффективна, так как извлекаются дополнительные данные. Однако в этом случае упреждающая загрузка обеспечивает наилучшую производительность, так как для каждой записи отображаются связанные данные.

      Дополнительные сведения о вопросах производительности при загрузке связанных данных см. в разделе **Lazy, безотлагательная и явная загрузка связанных** данных статьи [чтение связанных данных с помощью Entity Framework в приложении ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/reading-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md) .

      По умолчанию данные сортируются по значениям свойства, отмеченного как ключ. Можно добавить предложение `OrderBy`, чтобы указать другое значение сортировки. В этом примере для сортировки используется свойство `StudentID` по умолчанию. В статье [Сортировка, разбиение по страницам и фильтрация данных](sorting-paging-and-filtering-data.md) пользователю разрешено выбирать столбец для сортировки.
 
   4. Сохраните Students.aspx.cs.

## <a name="run-your-application"></a>Запуск приложения 

Запустите веб-приложение (**F5**) и перейдите на страницу **учащихся** , на которой отображается следующее:

   ![Отображение данных](retrieving-data/_static/image16.png)

## <a name="automatic-generation-of-model-binding-methods"></a>Автоматическое создание методов привязки модели

При работе с этой серией руководств можно просто скопировать код из учебника в проект. Однако одним из недостатков этого подхода является то, что вы не сможете быть осведомлены о функции, предоставляемой Visual Studio, для автоматического создания кода для методов привязки модели. При работе с собственными проектами автоматическое создание кода может сэкономить время и помочь вам понять, как реализовать операцию. В этом разделе описывается функция автоматического создания кода. Этот раздел является только информационным и не содержит кода, необходимого для реализации в проекте. 

При задании значения свойств `SelectMethod`, `UpdateMethod`, `InsertMethod`или `DeleteMethod` в коде разметки можно выбрать параметр **создать новый метод** .

![Создание метода](retrieving-data/_static/image18.png)

Visual Studio не только создает метод в коде программной части с правильной сигнатурой, но также создает код реализации для выполнения операции. Если сначала задать свойство `ItemType` перед использованием функции автоматического создания кода, созданный код использует этот тип для операций. Например, при задании свойства `UpdateMethod` автоматически создается следующий код:

[!code-csharp[Main](retrieving-data/samples/sample9.cs)]

Опять же, этот код не нужно добавлять в проект. В следующем учебнике будут реализованы методы обновления, удаления и добавления новых данных.

## <a name="summary"></a>Сводка

В этом руководстве были созданы классы модели данных и создана база данных из этих классов. Вы заполнили таблицы базы данных тестовыми данными. Вы использовали привязку модели для получения данных из базы данных, а затем отображает их в элементе управления GridView.

В следующем [руководстве](updating-deleting-and-creating-data.md) этой серии вы включите обновление, удаление и создание данных.

> [!div class="step-by-step"]
> [Дальше](updating-deleting-and-creating-data.md)
